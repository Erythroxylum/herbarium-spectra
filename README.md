# Herbarium-Spectra  
Datasets and scripts for the **NPH paper**.

---

## Data processing
**`R/Spectrolab_process_data.R`**

Script for combining spectra and metadata files and manipulating spectra for output to analysis scripts.

---

## Trait Estimation  

The main script for trait estimation is:  
**`R/leaf_trait_prediction.R`**

### Overview  

This script takes as input either the **Kothari dataset** or the **herbarium dataset**, sets the metadata accordingly, and runs the necessary routines to estimate traits and generate output files for analysis.

### Auxiliary scripts
**`R/

### Data Output  

The script generates the following data files:  

- **`pls_*_split.rds`**  
  Testing and validation sample splits.  
- **`pls_*_segments.rds`**  
  Dataset iterations selecting random spectra per individual, based on the `accession` metadata column.  
- **`ncomp_onesigma-*.txt`**  
  Optimal number of components calculated using the one-sigma method from the `model_tune.R` function.  
- **`ncomp_otherMetrics-*.txt`**  
  Min or max values from PRESS, RMSEP, and R² statistics during cross-validation.  
- **`pls_*_opt_comp_models.csv`**  
  Cross-validation models from `model_tune`.  
- **`pls_*_final_models.rds`**  
  Final models across segments generated by the `model_build.R` function.  
- **`*performance.csv`**  
  Table containing the following metrics across segments:  
  - nsamples, R², Bias, RMSE, %RMSE, Intercept, Slope
- **`*obs-pred.csv`**  
  Data for plotting observed vs. predicted trait values, including sample metadata:  
  - Species, genus, accession, growth form, project, green index, discoloration  
  - Observed and predicted trait values (`mean`, `sd`, `se`)  
  - Residual statistics (`mean`, `sd`, `se`)  
- **`*obs-pred-avg.csv`**  
  Similar to `*obs-pred.csv`, but averaged values are calculated for individuals.  
- **`pls_*_coefficients.csv`**  
  Model coefficients across segments.  
- **`pls_*_vip.csv`**  
  Variable importance in projection (VIP) scores across segments.  
- **`*plot.pdf`**  
  Plots showing ncomp optimization statistics.

### Plotting scripts
**`R/plotting_functions_traits.R`**
---


---
### Additional scripts
**`phylogenetic_diversity.R`**

**`phylogenetic_diversity.R`**

